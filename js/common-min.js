"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var e=0;e<i.length;e++){var c=i[e];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function _createClass(t,i,e){return i&&_defineProperties(t.prototype,i),e&&_defineProperties(t,e),t}var categories=$(".Nav__sub__Item--categories"),categoriesList=$(".js-headerCategories"),categoriesFlag=!0;function hideCategories(t){t.hasClass("Nav__link Nav__link--arrow")||categoriesList.fadeOut(300,function(){categoriesList.removeClass("categoriesActive"),categoriesFlag=!0})}categories.on("click",function(){categoriesFlag?(categoriesFlag=!1,categoriesList.fadeIn(300),setTimeout(function(){categoriesList.addClass("categoriesActive"),categoriesList.removeAttr("style")})):categoriesList.fadeOut(300,function(){categoriesList.removeClass("categoriesActive"),categoriesFlag=!0})});var searchInputValue,searchInput=$(".search");searchInput.on("input",function(){searchInputValue=searchInput[0].value});var profile=$(".Nav__icon__Item--profile"),profileListAuth=$(".Profile__list--auth"),profileListUnAuth=$(".Profile__list--unAuth"),profileAuth=!1,profileFlag=!0;function hideProfile(t){t.hasClass("Nav__icon__Item--profile")||$(".Profile__list").slideUp(300,function(){profileFlag=!0})}profile.on("click",function(){profileAuth?profileFlag?(profileFlag=!1,profileListAuth.slideDown(300),profile.addClass("profileActive")):profileListAuth.slideUp(300,function(){profile.removeClass("profileActive"),profileFlag=!0}):profileFlag?(profileFlag=!1,profileListUnAuth.slideDown(300),profile.addClass("profileActive")):profileListUnAuth.slideUp(300,function(){profile.removeClass("profileActive"),profileFlag=!0})});var cart=$(".Nav__icon__Item--cart");cart.on("click",function(){window.location.assign("layouts/cart.html")});var wish=$(".Nav__icon__Item--like, .Profile__item--wish"),wishBox=$(".WishBox");function hideWish(t){wishBox.fadeOut(300)}wish.on("click",function(){wishBox.fadeIn(300)}),wishBox.on("click",function(t){var i=$(t.target);i.hasClass("Product__delete--closeWishBox")&&wishBox.fadeOut(300),(i.hasClass("WishBox__item")||i.hasClass("WishBox__item__Title")||i.hasClass("WishBox__item__Price")||i.hasClass("WishBox__item__Stoke")||"IMG"==i.prop("tagName"))&&location.assign("layouts/product_card.html")});var WishFlag,CartFlag,WishIco=$(".Icons--heart"),WishBoxList=$(".WishBox__list"),LikeInc=$(".Like__inc"),CartProducts=$(".Products"),CartIco=$(".Icons--plus"),CartInc=$(".Cart__inc"),ProductBtn=$(".Product__btn"),ItemDetails=$(".Item__details"),LocalStorage=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"getProduct",value:function(t){var i=localStorage.getItem(t);return JSON.parse(i)}},{key:"setProduct",value:function(t,i){localStorage.setItem(i,JSON.stringify(t))}}]),t}(),locStorage=new LocalStorage("product"),wishProducts=locStorage.getProduct("wish"),cartProducts=locStorage.getProduct("cart");null==wishProducts&&(wishProducts=[]),null==cartProducts&&(cartProducts=[]),LikeInc.text(wishProducts.length),CartInc.text(cartProducts.length);for(var i=0;i<wishProducts.length;i++)WishProduct(locStorage.getProduct("wish")[i].id,locStorage.getProduct("wish")[i].img,locStorage.getProduct("wish")[i].name,locStorage.getProduct("wish")[i].price);for(i=0;i<cartProducts.length;i++)CartProduct(locStorage.getProduct("cart")[i].id,locStorage.getProduct("cart")[i].img,locStorage.getProduct("cart")[i].name,locStorage.getProduct("cart")[i].price,locStorage.getProduct("cart")[i].quantity);for(i=0;i<wishProducts.length;i++){var id=wishProducts[i].id;WishIco.closest("ul").find("#".concat(id)).find(".WishText").text("Удалить из избранных"),WishIco.closest("ul").find("#".concat(id)).find(".Icons--heart").removeClass("Icons--heart").addClass("Icons--heartActive")}for(i=0;i<cartProducts.length;i++){id=cartProducts[i].id;CartIco.closest("ul").find("#".concat(id)).find(".CartText").text("Удалить из корзины"),CartIco.closest("ul").find("#".concat(id)).find(".Icons--plus").removeClass("Icons--plus").addClass("Icons--plusActive")}function operationProduct(t,i,e,c){if("wish"==c){WishFlag=!0;var o=wishProducts}else if("cart"==c){CartFlag=!0;o=cartProducts}for(var s=0;s<o.length;s++)if(o[s].id===i.id){var a=locStorage.getProduct(c);a.splice(s,1),locStorage.setProduct(a,c),"wish"==c?o=wishProducts=locStorage.getProduct(c):"cart"==c&&(o=cartProducts=locStorage.getProduct(c)),"wish"==c?WishBoxList.find("#".concat(i.id)).remove():CartProducts.find("#".concat(i.id)).fadeOut(300,function(){$(this).remove()}),t&&"wish"==c?changeTextAndIco(c,"Добавить в избранное",t):t&&"cart"==c&&changeTextAndIco(c,"Добавить в корзину",t),"wish"==c?(LikeInc.text(o.length),WishFlag=!1):"cart"==c&&(CartInc.text(o.length),ProductBtn.text("Добавить"),CartFlag=!1)}e&&e(i,t,c)}function addProduct(t,i,e){if("wish"==e)var c=WishFlag,o=wishProducts;else c=CartFlag,o=cartProducts;c&&(o.push(t),locStorage.setProduct(o,e),"wish"==e?(WishProduct(t.id,t.img,t.name,t.price),changeTextAndIco(e,"Удалить из избранных",i),LikeInc.text(wishProducts.length)):"cart"==e&&(CartProduct(t.id,t.img,t.name,t.price,t.quantity),changeTextAndIco(e,"Удалить из корзины",i),CartInc.text(cartProducts.length),ProductBtn.text("Удалить")))}function changeTextAndIco(t,i,e){if("wish"==t){var c="WishText";if("Удалить из избранных"==i)var o="Icons--heart",s="Icons--heartActive";else o="Icons--heartActive",s="Icons--heart"}else{c="CartText";if("Удалить из корзины"==i)o="Icons--plus",s="Icons--plusActive";else o="Icons--plusActive",s="Icons--plus"}e.find("."+c).text(i),e.find("."+o).removeClass(o).addClass(s)}function WishProduct(t,i,e,c){if("index.html"==location.pathname.split("/").pop()&&".."==i.split("/")[0]){var o=i.split("/");o.splice(0,1),i=o.join("/")}$('\n\t\t<li class="WishBox__item" id="'.concat(t,'">\n\t\t\t<div class="Product__delete"></div>\n\t\t\t<div class="WishBox__item__Img">\n\t\t\t\t<img src="').concat(i,'" alt="Product">\n\t\t\t</div>\n\t\t\t<div class="WishBox__item__Desc">\n\t\t\t\t<div class="WishBox__item__Title">').concat(e,'</div>\n\t\t\t\t<div class="WishBox__item__Price">').concat(c,'</div>\n\t\t\t\t<div class="WishBox__item__Stoke">В наличии</div>\n\t\t\t</div>\n\t\t</li>\n\t')).appendTo(WishBoxList)}function CartProduct(t,i,e,c,o){var s=location.pathname.split("/").pop();if("cart.html"==s)".."!=i.split("/")[0]&&(i="../"+i);else if("index.html"==s&&".."==i.split("/")[0]){var a=i.split("/");a.splice(0,1),i=a.join("/")}o||(o=1),c=parseFloat(c),o=parseFloat(o),$('\n\t\t<div class="Cart__Product" id="'.concat(t,'">\n\t\t\t<div class="Product__info">\n\t\t\t\t<div class="Cart__Product__img">\n\t\t\t\t\t<img src="').concat(i,'" alt="Product">\n\t\t\t\t</div>\n\t\t\t\t<div class="Cart__Product__desc">\n\t\t\t\t\t<div class="Product__desc__Name">').concat(e,'</div>\n\t\t\t\t\t<div class="Product__desc__Price">').concat(c/o,'р</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="Product__quantity">\n\t\t\t\t<span class="minus">&minus;</span>\n\t\t\t\t<span class="result">\n\t\t\t\t\t<input class="result__input" type="number" value="').concat(o,'">\n\t\t\t\t</span>\n\t\t\t\t<span class="plus">+</span>\n\t\t\t</div>\n\t\t\t<div class="Product__desc__Price--bigFormat">').concat(c,'р</div>\n\t\t\t<div class="Product__delete"></div>\n\t\t</div>\n\t')).appendTo(CartProducts)}function isInteger(t){return(0^t)===t}WishIco.on("click",function(t){var i=$(t.target).closest("li"),e=i.attr("id"),c=i.find("img").attr("src"),o=i.find(".Item__price").text(),s=i.find(".Item__desc").text();operationProduct(i,{id:e,img:c,price:o,name:s},addProduct,"wish")}),WishBoxList.on("click",function(t){var i=$(t.target);if(i.hasClass("Product__delete")){var e=i.closest("li").attr("id");operationProduct(null,{id:e},null,"wish"),WishIco.closest("ul").find("#".concat(e)).find(".WishText").text("Добавить в избранное"),WishIco.closest("ul").find("#".concat(e)).find(".Icons--heartActive").removeClass("Icons--heartActive").addClass("Icons--heart"),WishFlag=!0}}),CartIco.on("click",function(t){var i=$(t.target).closest("li"),e=i.attr("id"),c=i.find("img").attr("src"),o=i.find(".Item__desc").text(),s=i.find(".Item__price").text();operationProduct(i,{id:e,img:c,price:s,name:o},addProduct,"cart")}),CartProducts.on("click",function(t){var i=$(t.target);if(i.hasClass("Product__delete")){var e=i.closest(".Cart__Product").attr("id");operationProduct(null,{id:e},null,"cart"),CartIco.closest("ul").find("#".concat(e)).find(".CartText").text("Добавить в корзину"),CartIco.closest("ul").find("#".concat(e)).find(".Icons--plus").removeClass("Icons--plusActive").addClass("Icons--plus"),CartFlag=!0}}),ItemDetails.on("click",function(t){var i=$(t.target).closest("li"),e={id:i.attr("id"),img:"../"+i.find("img").attr("src"),name:i.find(".Item__desc").text(),price:i.find(".Item__price").text()};locStorage.setProduct(e,"temporary")}),$(document).on("click",function(t){var i=$(t.target);hideProfile(i),hideCategories(i)}),$(document).on("keyup",function(t){hideWish(t.key)});