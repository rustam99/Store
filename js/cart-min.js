"use strict";$(document).ready(function(){var t,e,a,r,o,n,s=$(".Cart__Product"),l=s.length,i=$(".Product__quantity"),c=$(".Product__desc__Price--bigFormat"),_=$(".Product__subtotal__Sum"),u=$(".Product__total__Sum"),d=$(".Product__ship__Box"),p=0,x=0,f=$(".Product__Controls"),v=$(".Product__cupon__Input"),P=$(".CuponNotice"),F="Rustam",g=0,m=!0,h=$(".Product__delete"),C=!0,y=0,b=0;s.length||($(".EmptyCartTitle").fadeIn(300),$(".EmptyCartImg").fadeIn(300));for(var B=0;B<c.length;B++)p+=parseFloat(c[B].innerText);_.text(p+"р"),u.text(_.text()),$(".Product__ship__Box").find("input:checked").closest("label").find("span").text().split(" ").map(function(t){parseFloat(t)&&(x=parseFloat(t))}),"number"==typeof x&&$(".Product__total__Sum").text(parseFloat($(".Product__total__Sum").text())+x+"р");var k=!0;if(locStorage.getProduct("cart").length){var I=locStorage.getProduct("cart")[0].cupon;I&&(k=!1,$(".Product__cupon__Btn").prop("disabled",!0).addClass("BtnDisabled"),_.text(parseFloat(_.text())-I+"р"),u.closest(".Product__total").find("span").fadeIn(300),u.text(parseFloat(u.text())-I+"р"))}var S=[];for(B=0;B<i.find(".result__input").length;B++)S.push(parseInt(i.find(".result__input")[B].value));function T(t){if(n===F&&(g=2e3,m))if(parseFloat(_.text())-g<0)P.find(".Cupon__price").text(g+"р"),g=0,P.slideDown(300);else if(m=!1,_.text(parseFloat(_.text())-g+"р"),u.text(parseFloat(u.text())-g+"р"),P.slideUp(300),u.closest(".Product__total").find("span").fadeIn(300),v.val(""),v.blur(),t)t.prop("disabled",!0),t.addClass("BtnDisabled");else{var e=$(".Product__cupon__Btn");e.prop("disabled",!0),e.addClass("BtnDisabled")}}function E(){g=0,I=0,m=!0,k=!0,f.find(".Product__cupon__Btn").prop("disabled",!1).removeClass("BtnDisabled"),u.closest(".Product__total").find("span").fadeOut(300)}function q(){if(I)var t=I;else t=g;p=0;for(var e=0;e<c.length;e++)p+=parseFloat(c[e].innerText);p-=b+t,_.text(p+"р"),u.text(parseFloat(_.text())+parseFloat(x)+"р")}i.on("click",function(n){var s=$(n.target),l=s.closest(".Cart__Product");t=$(".result__input"),a=$(".Product__desc__Price--bigFormat"),o=$(".Product__desc__Price");var i=t.index(s.closest(".Product__quantity").find(".result__input")),c=a.index(l.find(".Product__desc__Price--bigFormat")),d=o.index(l.find(".Product__desc__Price"));t=t.eq(i),e=t.val(),a=a.eq(c),o=o.eq(d),r=parseFloat(o.text()),function(o){S.push(e);var n=o.closest(".Product__quantity").find(".result__input"),s=$(".result__input").index(n);(""===n.val()||e<=0)&&(S.splice(S.indexOf(""),1),e=S[s]);if(S[s]=S[S.length-1],I)var l=I;else var l=g;o.hasClass("minus")&&(--e<=1&&(e=1),parseFloat(_.text())-r<0&&(_.text(parseFloat(_.text())+l+"р"),u.text(parseFloat(u.text())+l+"р"),E()),1!==e?a.text(r*e+"р"):a.text(r+"р"),t.val(e));o.hasClass("plus")&&(++e>=10&&(e=10),1!==e?a.text(r*e+"р"):a.text(r+"р"),t.val(e));q()}(s)}),i.on("keyup",function(t){var e=$(t.target),a=t.key;if(I)var r=I;else r=g;var o=e.closest(".Product__quantity").next(),n=parseFloat(e.closest(".Cart__Product").find(".Product__desc__Price").text()),s=parseFloat(e.val());s>=10&&(s=10,e.val(s)),S.push(s);var l=$(".result__input").index(e);(""===e.val()||s<=0)&&(S.splice(S.indexOf(""),1),s=S[l]),"+"!==a&&"-"!==a&&"."!==a||e.val(S[l]),isInteger(s)||""===e.val()||(s=S[l],S[S.length-1]=s,e.val(s)),S[l]=S[S.length-1],o.text(n*s+"р"),parseFloat(_.text())-n<0&&(_.text(parseFloat(_.text())+r+"р"),u.text(parseFloat(u.text())+r+"р"),E()),q()}),d.on("input",function(t){var e=$(t.target).closest("label").find("span").text();e.split(" ").map(function(t){parseFloat(t),parseFloat(t)&&(e=parseFloat(t))}),"number"==typeof e?(u.text(parseFloat(u.text())+e+"р"),x=parseFloat(e)):(x=0,u.text(_.text())),d.find("input:checked")&&d.removeClass("Product__ship__Box--active")}),v.on("input",function(){n=v.val()}),f.on("click",function(t){var e=$(t.target);if(e.hasClass("Product__cupon__Btn")&&T(e),e.hasClass("CartUpdateBtn")){for(var a=locStorage.getProduct("cart"),r=0;r<a.length;r++)a[r].cupon=0;locStorage.setProduct(a,"cart"),location.reload()}}),$(document).on("keypress",function(t){var e=t.key;k&&"Enter"===e&&T()}),h.on("click",function(t){if(I)var e=I;else e=g;var a=$(t.target).closest(".Cart__Product");C&&(C=!1,y=parseFloat(a.find(".Product__desc__Price--bigFormat").text()),b+=y,setTimeout(function(){l--,parseFloat(_.text())-y<0?(_.text(parseFloat(_.text())-y+e+"р"),u.text(parseFloat(u.text())-y+e+"р"),E()):(_.text(parseFloat(_.text())-y+"р"),u.text(parseFloat(u.text())-y+"р")),parseFloat(_.text())<0&&(_.text(parseFloat(_.text())+e+"р"),u.text(parseFloat(u.text())+e+"р"),E()),l||($(".EmptyCartTitle").fadeIn(300),$(".EmptyCartImg").fadeIn(300)),C=!0},300))});var D=$(".ProductBuy"),O=!0;D.on("click",function(){if($(".Cart__Product").length)if(d.find("input:checked").length){for(var t=d.find("input:checked").parent().find("span")[0].innerText,e=JSON.parse(localStorage.getItem("cart")),a=$(".result__input"),r=0;r<e.length;r++)e[r].quantity=a[r].value,e[r].price=c[r].innerText,e[r].ship=t,g&&(e[r].cupon=g);localStorage.setItem("cart",JSON.stringify(e)),location.assign("checkout.html")}else d.addClass("Product__ship__Box--active");else O&&(O=!1,$(".EmptyCartTitle").addClass("EmptyCartTitle--active"),setTimeout(function(){$(".EmptyCartTitle").removeClass("EmptyCartTitle--active"),O=!0},1e3))})});